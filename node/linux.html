<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>pm2 | web Ninga</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/junnian-blog/search.ico">
    <script>
    var _hmt = _hmt || [];
    (function(){
      let hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?1a7062b879a785e4c4c743ef69d9724e";
      let s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();     
    </script>
    <meta name="description" content="...">
    
    <link rel="preload" href="/junnian-blog/assets/css/0.styles.b49e8280.css" as="style"><link rel="preload" href="/junnian-blog/assets/js/app.065978ad.js" as="script"><link rel="preload" href="/junnian-blog/assets/js/2.93fcb68c.js" as="script"><link rel="preload" href="/junnian-blog/assets/js/18.6dcefcb3.js" as="script"><link rel="prefetch" href="/junnian-blog/assets/js/10.0509449f.js"><link rel="prefetch" href="/junnian-blog/assets/js/11.75c24a4a.js"><link rel="prefetch" href="/junnian-blog/assets/js/12.4954cf2c.js"><link rel="prefetch" href="/junnian-blog/assets/js/13.c18dd2b0.js"><link rel="prefetch" href="/junnian-blog/assets/js/14.388296b2.js"><link rel="prefetch" href="/junnian-blog/assets/js/15.ff528b19.js"><link rel="prefetch" href="/junnian-blog/assets/js/16.ac91c413.js"><link rel="prefetch" href="/junnian-blog/assets/js/17.4777b7b1.js"><link rel="prefetch" href="/junnian-blog/assets/js/19.8db05fcc.js"><link rel="prefetch" href="/junnian-blog/assets/js/20.49d09ed6.js"><link rel="prefetch" href="/junnian-blog/assets/js/21.dbebad99.js"><link rel="prefetch" href="/junnian-blog/assets/js/22.9c1ce438.js"><link rel="prefetch" href="/junnian-blog/assets/js/23.77aad825.js"><link rel="prefetch" href="/junnian-blog/assets/js/24.f4d03864.js"><link rel="prefetch" href="/junnian-blog/assets/js/25.29e5d654.js"><link rel="prefetch" href="/junnian-blog/assets/js/3.82600b03.js"><link rel="prefetch" href="/junnian-blog/assets/js/4.70a0a44b.js"><link rel="prefetch" href="/junnian-blog/assets/js/5.37af7dc0.js"><link rel="prefetch" href="/junnian-blog/assets/js/6.0fe103ba.js"><link rel="prefetch" href="/junnian-blog/assets/js/7.3281e2c9.js"><link rel="prefetch" href="/junnian-blog/assets/js/8.5349eec0.js"><link rel="prefetch" href="/junnian-blog/assets/js/9.e5eea47b.js">
    <link rel="stylesheet" href="/junnian-blog/assets/css/0.styles.b49e8280.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/junnian-blog/" class="home-link router-link-active"><!----> <span class="site-name">web Ninga</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/junnian-blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/junnian-blog/path.html" class="nav-link">
  学习路线
</a></div><div class="nav-item"><a href="/junnian-blog/amway.html" class="nav-link">
  资源推荐
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/junnian-blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/junnian-blog/path.html" class="nav-link">
  学习路线
</a></div><div class="nav-item"><a href="/junnian-blog/amway.html" class="nav-link">
  资源推荐
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>pm2</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/junnian-blog/node/linux.html#初步了解" class="sidebar-link">初步了解</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/junnian-blog/node/linux.html#关于服务器-linux" class="sidebar-link">关于服务器 Linux</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/junnian-blog/node/linux.html#linux系统文件属性" class="sidebar-link">Linux系统文件属性</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/junnian-blog/node/linux.html#linux权限" class="sidebar-link">Linux权限</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/junnian-blog/node/linux.html#了解nignx" class="sidebar-link">了解Nignx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/junnian-blog/node/linux.html#安装nignx方式1-简单" class="sidebar-link">安装Nignx方式1（简单）</a></li><li class="sidebar-sub-header"><a href="/junnian-blog/node/linux.html#安装nignx方式2-自行搭建安装环境" class="sidebar-link">安装Nignx方式2（自行搭建安装环境）</a></li></ul></li><li><a href="/junnian-blog/node/linux.html#nginx常用命令" class="sidebar-link">nginx常用命令</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/junnian-blog/node/linux.html#nginx-反向代理" class="sidebar-link">nginx 反向代理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/junnian-blog/node/linux.html#vue项目-history模式下路由刷新404" class="sidebar-link">Vue项目 history模式下路由刷新404</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/junnian-blog/node/linux.html#添加日志分析工具" class="sidebar-link">添加日志分析工具</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/junnian-blog/node/linux.html#nginx-负载均衡" class="sidebar-link">Nginx 负载均衡</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="pm2"><a href="#pm2" class="header-anchor">#</a> pm2</h1> <p><a href="https://pm2.fenxianglu.cn/" target="_blank" rel="noopener noreferrer">PM2中文网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>作用：管理node进程，简化node管理任务。</p> <p>优点：</p> <ul><li>后台运行</li> <li>停机重载</li> <li>控制台检测</li> <li>提供 http api</li> <li>内建负载均衡（基于node cluster模块）</li> <li>自动停止不稳定进程，避免无限循环</li> <li>提供远程的事实api服务（node模块允许pm2进程管理器交互）</li></ul> <h2 id="初步了解"><a href="#初步了解" class="header-anchor">#</a> 初步了解</h2> <p>常用命令：</p> <div class="language- extra-class"><pre class="language-text"><code>&gt;&gt; mkdir xxx 创建文件夹
&gt;&gt; echo &gt;xxx.js 创建xxx文件
&gt;&gt; ls 查看当前目录
&gt;&gt; dir 查看当前目录
</code></pre></div><ol><li>初始化环境 <code>npm init</code>或者<code>npm init -y</code>，生成 package.json</li> <li>初始化环境 <code>npm init -y</code></li> <li>安装依赖 <code>cnpm install express</code>、<code>cnpm install pm2 -g</code></li> <li>验证pm2 <code>pm2 -v</code></li> <li>使用pm2启动node服务 <code>pm2 start index.js</code>,如下既是启动成功</li></ol> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">PS</span> C:\Users\junnian\Desktop\pm2_demo&gt; pm2 <span class="token function">start</span> indexindex<span class="token punctuation">.</span>js
<span class="token namespace">[PM2]</span> Starting C:\Users\junnian\Desktop\pm2_demo\index5000<span class="token punctuation">.</span>js in fork_mode <span class="token punctuation">(</span>1 instance<span class="token punctuation">)</span><span class="token namespace">[PM2]</span> Done<span class="token punctuation">.</span>
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ index              │ fork     │ 0    │ online    │ 0%       │ 27<span class="token punctuation">.</span>4mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
<span class="token function">PS</span> C:\Users\junnian\Desktop\pm2_demo&gt; pm2 <span class="token function">start</span> index8000<span class="token punctuation">.</span>js
</code></pre></div><p>pm2常用命令：</p> <ul><li><code>pm2 start index.js</code> 启动index.js进程</li> <li><code>pm2 start index.js --watch</code> 启动index.js进程并监听，会即时重启服务</li> <li><code>pm2 list</code> 查看当前管理进程</li> <li><code>pm2 log</code> 查看当前日志</li> <li><code>pm2 stop id</code> 停止指定id进程</li> <li><code>pm2 restart id</code> 重新启动指定id进程</li> <li><code>pm2 delete id</code> 删除指定id进程</li></ul> <p>补充：VSCODE终端无法运行脚本的解决方式：</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">PS</span> C:\Windows\system32&gt; <span class="token function">get-ExecutionPolicy</span>
Restricted
<span class="token function">PS</span> C:\Windows\system32&gt; <span class="token function">set-ExecutionPolicy</span><span class="token punctuation">;</span>

位于命令管道位置 1 的 cmdlet <span class="token function">Set-ExecutionPolicy</span>
请为以下参数提供值:
ExecutionPolicy: RemoteSigned

执行策略更改
执行策略可帮助你防止执行不信任的脚本。更改执行策略可能会产生安全风险，如 https:<span class="token operator">/</span>go<span class="token punctuation">.</span>microsoft<span class="token punctuation">.</span>com/fwlink/?LinkID=135170
中的 about_Execution_Policies 帮助主题所述。是否要更改执行策略?
<span class="token namespace">[Y]</span> 是<span class="token punctuation">(</span>Y<span class="token punctuation">)</span>  <span class="token namespace">[A]</span> 全是<span class="token punctuation">(</span>A<span class="token punctuation">)</span>  <span class="token namespace">[N]</span> 否<span class="token punctuation">(</span>N<span class="token punctuation">)</span>  <span class="token namespace">[L]</span> 全否<span class="token punctuation">(</span>L<span class="token punctuation">)</span>  <span class="token namespace">[S]</span> 暂停<span class="token punctuation">(</span>S<span class="token punctuation">)</span>  <span class="token punctuation">[</span>?<span class="token punctuation">]</span> 帮助 <span class="token punctuation">(</span>默认值为“N”<span class="token punctuation">)</span>: Y
<span class="token function">PS</span> C:\Windows\system32&gt; <span class="token function">get-ExecutionPolicy</span>
RemoteSigned
</code></pre></div><h2 id="关于服务器-linux"><a href="#关于服务器-linux" class="header-anchor">#</a> 关于服务器 Linux</h2> <p>在线云服务推荐：<a href="https://cn.aliyun.com/" target="_blank" rel="noopener noreferrer">阿里云<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://cloud.tencent.com/" target="_blank" rel="noopener noreferrer">腾讯云<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>等</p> <p>管理Linux服务器或者进行向服务器传文件时，需要使用ssh客户端连接到服务器，使用Mac或者Linux桌面系统可以直接使用SSH命令，windows系统需要额外安装工作支持，推荐：<a href="https://www.xshell.com/zh/xshell/" target="_blank" rel="noopener noreferrer">Xshell<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>或者<a href="https://www.openssh.com/portable.html#downloads" target="_blank" rel="noopener noreferrer">OpenSSH<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="">Git</a></p> <p>使用SSH连接linux服务器（准备好账户、密码和公网地址）: <code>ssh username@ip</code>，如下：按要求输入密码并选择是否保存SSH密钥，即可进入服务器：</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>Microsoft Windows <span class="token punctuation">[</span>版本 10<span class="token punctuation">.</span>0<span class="token punctuation">.</span>19045<span class="token punctuation">.</span>2673<span class="token punctuation">]</span>
<span class="token punctuation">(</span>c<span class="token punctuation">)</span> Microsoft Corporation。保留所有权利。

C:\Users\junnian&gt;ssh root@47<span class="token punctuation">.</span>108<span class="token punctuation">.</span>233<span class="token punctuation">.</span>39
The authenticity of host <span class="token string">'47.108.233.39 (47.108.233.39)'</span> can<span class="token string">'t be established.
ECDSA key fingerprint is SHA256:ygmvjM7zUYovESAq8biGYVOLwD3Wn2KqPkG7Uz6AOe8.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>47<span class="token punctuation">.</span>108<span class="token punctuation">.</span>233<span class="token punctuation">.</span>39<span class="token string">' (ECDSA) to the list of known hosts.
root@47.108.233.39'</span>s password:
Last failed login: Thu Mar  9 19:12:03 CST 2023 <span class="token keyword">from</span> 27<span class="token punctuation">.</span>227<span class="token punctuation">.</span>244<span class="token punctuation">.</span>45 on ssh:notty
There were 2 failed login attempts since the last successful login<span class="token punctuation">.</span>

Welcome to Alibaba Cloud Elastic Compute Service <span class="token operator">!</span>

<span class="token namespace">[root@iZ2vcc0d34kg5yk3n27ekyZ ~]</span><span class="token comment">#</span>
</code></pre></div><p>Linux 常用命令</p> <div class="language-linux extra-class"><pre class="language-text"><code>&gt; ls 查看当前文件夹下所有文件
&gt; pwd 查看当前文件夹
&gt; cd .. 切换到上一级文件夹
&gt; cd ~  切换到家目录（刚进入系统的那个目录）
&gt; cd /  切换到根目录文件夹
&gt; wget https://nodejs.org/dist/v18.15.0/node-v18.15.0-linux-x64.tar.xz 下载指定文件
&gt; tar -xf node-v18.15.0-linux-x64.tar.xz 解压指定文件
&gt; $PATH 查看环境变量（冒号分隔）
&gt; vi xxx 使用vim编辑器打开当前目录指定文件

&gt; mkdir xxx 新建指定文件夹
&gt; touch index.js 新建index.js文件 

&gt; rm -f xxx 删除一个xxx文件
&gt; rmdir xxx 删除一个xxx目录
&gt; rm -rf xxx 删除一个xxx目录并同时删除其内容 
</code></pre></div><p>使用<code>wget url</code>命令安装 <a href="https://nodejs.org/en/download/" target="_blank" rel="noopener noreferrer">node.js Linux 版<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 二进制文件，Linux中使用鼠标右键粘贴内容。下载完成使用<code>tar -xvf node-v18.15.0-linux-x64.tar.xz</code>解压文件，并进入<code>/node-v18.15.0-linux-x64/bin</code>这个目录使用<code>ls</code>查看是否存在corepack  node  npm  npx文件，文件存在就使用<code>pwd</code>命令得到当前文件目录。</p> <p>进入<code>/etc</code>目录，使用vim编辑器（i开启编辑模式,esc退出当前模式，<code>:wq</code>保存并退出编辑器）打开profile文件<code>vi profile</code>，添加<code>export PATH=$PATH:/node-v18.15.0-linux-x64/bin</code>一行，使用<code>source profile</code>刷新当前shell环境，然后退出当前服务器<code>exit</code>并重新登录，使用<code>node -v</code>、<code>npm -v</code>查看当前node版本。</p> <p>在根文件使用mkdir新建node-server文件，并在此文件内新建server文件...</p> <p>完成后使用 pm2 启动node服务，需要注意，此时需要在阿里云安全组配置面板中添加防火墙规则，将node服务端口开放暴露出去。</p> <p>使用<code>pm2 monit</code>即可监听node服务日志</p> <h2 id="linux系统文件属性"><a href="#linux系统文件属性" class="header-anchor">#</a> Linux系统文件属性</h2> <p><code>ls -l</code>（可简写为<code>ll</code>）即可查看当前文件夹下所有文件属性</p> <p>第一列表示文件属性和权限列：首字母：-代表文件,d代表文件夹，l表示超链接，c表示硬件，b表示u盘等移动存储设备。首字母后的所有字母则每三个划分为一组，共三组，分别表示的创建者权限（读、写、可执行），所在用户组权限（读、写、可执行）和其他用户权限（读、写、可执行），如果有下划线，则表示该权限缺失（如目录不可执行，则执行权限全部为_）。</p> <p>第二列表示文件数量，第三列表示用户名，第四列表示组名，第五列表示文件体积，第六列表示文件创建日期，第六列为文件名。</p> <p>示例：</p> <div class="language-linux extra-class"><pre class="language-text"><code>[root@iZ2vcc0d34kg5yk3n27ekyZ /]# ll
total 21964
lrwxrwxrwx.  1 root root        7 Feb  8 10:15 bin -&gt; usr/bin
dr-xr-xr-x.  5 root root     4096 Feb  8 10:38 boot
drwxr-xr-x  19 root root     2960 Mar  9 19:10 dev
drwxr-xr-x. 80 root root     4096 Mar 10 03:02 etc
drwxr-xr-x.  2 root root     4096 Apr 11  2018 home
lrwxrwxrwx.  1 root root        7 Feb  8 10:15 lib -&gt; usr/lib
lrwxrwxrwx.  1 root root        9 Feb  8 10:15 lib64 -&gt; usr/lib64
drwx------.  2 root root    16384 Feb  8 10:15 lost+found
drwxr-xr-x.  2 root root     4096 Apr 11  2018 media
drwxr-xr-x.  2 root root     4096 Apr 11  2018 mnt
drwxr-xr-x   3 root root     4096 Mar 10 03:42 node-server
drwxr-xr-x   6 1001 1001     4096 Aug 16  2022 node-v16.17.0-linux-x64
-rw-r--r--   1 root root 22419468 Aug 16  2022 node-v16.17.0-linux-x64.tar.xz
[root@iZ2vcc0d34kg5yk3n27ekyZ /]#
</code></pre></div><h2 id="linux权限"><a href="#linux权限" class="header-anchor">#</a> Linux权限</h2> <p>新建文件<code>touch index.txt</code></p> <p>使用<code>adduser username</code>新建账户，使用<code>passpwd username</code>为账户指定密码</p> <p>此时使用新建账户登录并尝试修改此文件时，会报错：无权限，且使用<code>ll</code>查看文件属性也会发现没有权限，如下：</p> <div class="language- extra-class"><pre class="language-text"><code>[junnian@iZ2vcc0d34kg5yk3n27ekyZ /]$ echo change&gt;index.txt
-bash: index.txt: Permission denied
[junnian@iZ2vcc0d34kg5yk3n27ekyZ /]$ ll
total 21968
-rw-r--r--    1 root root        6 Mar 10 11:35 index.txt
[junnian@iZ2vcc0d34kg5yk3n27ekyZ /]$ echo change&gt;index.txt
</code></pre></div><p>此时需要到root账户下使用<code>chmod</code>命令为文件指定权限：<code>[root@iZ2vcc0d34kg5yk3n27ekyZ /]# chmod 777 index.txt</code>，回到新建账户尝试修改文件，已经可以正常读写文件了:</p> <div class="language- extra-class"><pre class="language-text"><code>[junnian@iZ2vcc0d34kg5yk3n27ekyZ /]$ echo change&gt;index.txt
[junnian@iZ2vcc0d34kg5yk3n27ekyZ /]$ cat index.txt
change
</code></pre></div><p>关于<code>chmod</code>命令可以参考这篇文章:<a href="https://www.runoob.com/linux/linux-comm-chmod.html" target="_blank" rel="noopener noreferrer">Linux chmod命令<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="了解nignx"><a href="#了解nignx" class="header-anchor">#</a> 了解Nignx</h2> <p>Nignx是使用c开发的一个高性能http服务器，支持正反向代理（正向代理服务器，反向代理客户端）、负载均衡（轮询+权重），动静分离等特性。并且官方测试最高支持50,000个并发连接响应。</p> <h3 id="安装nignx方式1-简单"><a href="#安装nignx方式1-简单" class="header-anchor">#</a> 安装Nignx方式1（简单）</h3> <p>使用：<code>yum install nignx</code>即可</p> <h3 id="安装nignx方式2-自行搭建安装环境"><a href="#安装nignx方式2-自行搭建安装环境" class="header-anchor">#</a> 安装Nignx方式2（自行搭建安装环境）</h3> <p>补充：yum类似与node中的npm包管理工具</p> <ol><li>安装gcc环境，<code>[root@iZ2vcc0d34kg5yk3n27ekyZ ~]# yum install gcc-c++</code></li> <li>安装PCRE pcre-devel（基于pcre的二次开发库），nginx的http模块使用pcre来解析正则表达式。<code>yum install -y pcre pcre-devel</code></li> <li>安装 zlib 库，提供多种压缩和解压缩的方式， nginx 使用 zlib 对 http 包的内容进行 gzip 。<code>yum install -y zlib zlib-devel</code></li> <li>安装 OpenSSL，一个强大的安全套接字层密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及 SSL 协议，并提供丰富的应用程序供测试或其它目的使用。<code>yum install -y openssl openssl-devel</code></li> <li>下载Nginx，<code>wget https://nginx.org/download/nginx-1.19.9.tar.gz</code></li> <li>解压nginx，<code>tar -zxvf nginx-1.19.9.tar.gz</code></li> <li>执行nginx/configure文件</li> <li>编译文件会生成MakeFile文件夹，<code>make</code>。编译完成之后安装，<code>make install</code></li> <li>查询nginx安装位置，<code>whereis nginx</code></li> <li>进入安装位置并执行nginx</li> <li>将nginx加入环境变量，<code>/user/local/nginx/sbin</code>,重启服务器</li></ol> <p>现在尝试访问服务器80端口，需要提前开启80端口防火墙。</p> <h2 id="nginx常用命令"><a href="#nginx常用命令" class="header-anchor">#</a> nginx常用命令</h2> <div class="language- extra-class"><pre class="language-text"><code>nginx -v
nginx 启动nginx
ps -ef 查看当前系统所有进程
ps -ef | grep nginx 查看当前系统所有进程，并找出nginx进程
nginx -s stop 停止进程
nginx -s quit 停止进程（优雅停止）
nginx -s reload 重载nginx配置文件,刷新nginx缓存（nginx.conf）
nginx -t 检查nginx.conf是否有语法错误，会同时暴露nginx.conf地址
</code></pre></div><p>补充nginx.conf:</p> <ul><li>全局块：（user：指定用户/用户组（windows不支持）；worker_processes：配置nginx进程；error-log：错误日志；pid文件）</li> <li>events块：（accept_mutex:优化werker串行处理，默认开启；worker_connections:单个进程最大连接数）</li> <li>http块
<ul><li>server块（可以存在多个）
<ul><li>listen（指定监听端口/IP）</li> <li>location块（匹配模式，支持正则）</li></ul></li> <li>include块（引入其它配置）</li> <li>sendfile块（减少静态系统切换）</li> <li>log_format块（日志处理）</li> <li>gzip（开启gzip压缩）</li></ul></li></ul> <h2 id="nginx-反向代理"><a href="#nginx-反向代理" class="header-anchor">#</a> nginx 反向代理</h2> <p>如需要访问:http://47.108.233.39:5001/api/list服务，则nginx配置文件修改如下，80端口代理到指定域名：</p> <div class="language-config extra-class"><pre class="language-text"><code>http {
    server: {
        listin 80;
        location /api { ## /api请求均会被转发到代理服务器
            proxy_pass http://47.108.233.39:5001/;
        }
    }
}
</code></pre></div><p>使用<code>nginx -s reload</code>刷新nginx服务，即可尝试访问。</p> <h2 id="vue项目-history模式下路由刷新404"><a href="#vue项目-history模式下路由刷新404" class="header-anchor">#</a> Vue项目 history模式下路由刷新404</h2> <p>问题描述：当Vue项目使用了history模式时，路由跳转后刷新出现404。</p> <p>原因：服务器是根据页面url寻找资源的。但vue项目是单页面应用，打包好的web站点只有一个html页面，不存在其他资源目录下的html，服务器找不到对应页面所以报404。</p> <p>解决方案:根路径下配置如下：</p> <div class="language- extra-class"><pre class="language-text"><code>server {
    loaction / {
        try_files $uri $uri/ /index.html;
    }
}
</code></pre></div><p>这句命令的意思是如果给出的file都没有匹配到，则重新请求最后一个参数给定的uri，就是新的location匹配。</p> <h2 id="添加日志分析工具"><a href="#添加日志分析工具" class="header-anchor">#</a> 添加日志分析工具</h2> <p>P.S. 执行<code>try_files $uri $uri/ /index.html;</code>并重启即可将Linux命令提示设置为中文</p> <p>GoAccess是一款开源、实时，运行在命令行终端下的web日志分析工具。该工具提供快速、多样的HTTP状态统计，可以令管理员不再纠结于统计各类数据，和繁杂的指令以及一大堆管道/正则表达式。</p> <p><a href="https://www.goaccess.cc/?mod=man" target="_blank" rel="noopener noreferrer">GoAccess 操作手册<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,依照文档下载安装即可</p> <div class="language- extra-class"><pre class="language-text"><code>$ wget http://tar.goaccess.io/goaccess-1.2.tar.gz
$ tar -xzvf goaccess-1.2.tar.gz
$ cd goaccess-1.2/
$ ./configure
$ make
# make install
</code></pre></div><p>安装完成后,就可以全局使用<code>goaccess</code>命令了，此时进入nginx/logs/access.log文件，常规方式是使用<code>cat access.log</code>,安装成功goaccess后，则可以使用<code>goaccess -f access.log</code>,选择格式化模式即可格式化查看</p> <p>注意：make命令可能会报错:<code>configure: error: *** Missing development libraries for ncurses</code>。解决方式：根目录运行<code>yum -y install ncurses-devel</code>命令，安装ncurses-devel库即可</p> <h2 id="nginx-负载均衡"><a href="#nginx-负载均衡" class="header-anchor">#</a> Nginx 负载均衡</h2> <p>Nginx 负载均衡共有三种方式：</p> <ul><li>轮询方式负载（默认）</li> <li>负载权重分配</li> <li>负载超时分配</li></ul> <p>默认负载：</p> <div class="language-nginx.conf extra-class"><pre class="language-text"><code>http {

    upstream node {
        server 47.108.233.39:5000;
        server 47.108.233.39:5001;
        server 47.108.233.39:5003;
    }

    server {
        listen       80;
        server_name  localhost;
        location / {
                # root   html;
                # index  index.html index.htm;
                proxy_pass http://node;
        }
    }
}
</code></pre></div><p>按照权重weight 配置负载（权重与负载成正比关系，权重越大服务器承载的并发就越高）：</p> <div class="language-nginx.conf extra-class"><pre class="language-text"><code>upstream node {
    server 47.108.233.39:5000 weight=3;
    server 47.108.233.39:5001 weight=2;
    server 47.108.233.39:5003 weight=1;
}
</code></pre></div><p>按照故障等待超时时间fail_timeout backup，配置负载（backup是备用服务器参数，可以为一个upstream设置一个backup的server，在生产server全部都出问题之后，可以自动切换到备用server上，为回复服务争取时间）</p> <div class="language- extra-class"><pre class="language-text"><code>upstream  node {
    server 47.108.233.39:5000 fail_timeout=60;
    server 47.108.233.39:5001 fail_timeout=20;
    server 47.108.233.39:5003 backup;
}
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新日期:</span> <span class="time">3/11/2023, 3:32:44 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/junnian-blog/assets/js/app.065978ad.js" defer></script><script src="/junnian-blog/assets/js/2.93fcb68c.js" defer></script><script src="/junnian-blog/assets/js/18.6dcefcb3.js" defer></script>
  </body>
</html>
